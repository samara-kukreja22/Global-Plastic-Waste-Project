<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Plastic Waste by Country</title>
  <meta name="author" content="Samara and Erin">
  <meta name="description" content="A visual representation of Plastic Waste by Country">
  <meta content="text/html" http-equiv="Content-type" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src='https://cdn.plot.ly/plotly-2.6.3.min.js'></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <%- include ('global/navbar.ejs'); %>
  <%- include ('global/header');  %>
    <table>
      <tr>
        <th>Entity</th>
        <th>Year</th>
        <th>Plastic Waste Generation</th>
        <th>Mismanaged</th>
        <th>Inadequate</th>
        <th>perCapita</th>
      </tr>
      <tr>
        <td><%= data2.entity %></td>
        <td><%= data2.year %></td>
        <td><%= data2.pwg %></td>
        <td><%= data2.mismanaged %></td>
        <td><%= data2.inadequate %></td>
        <td><%= data2.perCapita %></td>
      </tr>
    </table>
    <div id = "pieChart"></div>
    <div id = "mismanagedChart"></div>
    <div id = "perCapitaChart"></div>
  <script>
    //inadequateChart
    let totalWaste = <%= data2.pwg %>;
    let inadequate = <%= data2.inadequate %>/100;//bc this is a percentage
    let inadequateWaste = totalWaste * inadequate;
    let adequateWaste = totalWaste - inadequateWaste;
    let data = [{values: [inadequateWaste, adequateWaste],
                labels: ["inadequate","adequate"],
                type: "pie"
    }];
    let layout = {
      title: 'Inadequate Waste<br>per country measured in tons',
      height: 400,
      width: 500
    };
    Plotly.newPlot('pieChart', data, layout);
    //mismanagedChart
    let globalWaste = totalWaste/(<%= data2.mismanaged %>/100);
    data = [{values: [globalWaste - totalWaste, totalWaste],
                labels: ["Global mis-<br>managed waste", "<%= data2.entity %>'s<br>share of mis-<br>managed waste"],
                type: "pie"
    }];
    layout = {
      title: 'Share of Global Mismanaged Waste<br>per country',
      height: 400,
      width: 500
    };
    Plotly.newPlot('mismanagedChart', data, layout);
    //barChart
    let labels = [<% for(let i=0; i<all_data.length; i++){ %>
                "<%= all_data[i].entity %>", <%}%>];
    let values = [<% for(let i=0; i<all_data.length; i++){ %>
                <%= all_data[i].perCapita %>, <%}%>];
    let colors = [<% for(let i=0; i<all_data.length; i++){ %>
                  '<%=
                  all_data[i].entity == data2.entity ? "rgba(222,45,38,0.8)": "rgba(204,204,204,1)";
                  %>', <%}%>
    ];
    //go through all data and put into lists
      let data1 = [{
      x: labels,
      y: values,
      marker:{
        color: colors
      },
      type: 'bar'
    }];
    layout = {
      xaxis: {title: 'Country'},
      yaxis: {title: 'Amount of Waste per Day in kilograms'},
      title: 'Plastic Waste Generated per Capita<br>per person per day in kilograms'
    };
    Plotly.newPlot('perCapitaChart', data1, layout);
  </script>
  <section id="summary">
    <h2>Summary:</h2>
    <ul>
      <p>
        This page displays <%= data2.entity %>'s plastic waste and their ways of disposing waste.
        <%= data2.inadequate %>% of <%= data2.entity %>'s  waste is inadequately disposed.
        <%= data2.mismanaged %>% is <%= data2.entity %>'s share of the global mismanaged waste.
        <%= data2.perCapita %> is how much plastic each person per day in <%= data2.entity %> generates in kilograms.

      </p>
    </ul>
  </section>
  <%- include ('global/footer');  %>
</body>

</html>
