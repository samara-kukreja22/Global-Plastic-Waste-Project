<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Plastic Waste by Country</title>
  <meta name="author" content="Samara and Erin">
  <meta name="description" content="A visual representation of Plastic Waste by Country">
  <meta content="text/html" http-equiv="Content-type" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src='https://cdn.plot.ly/plotly-2.6.3.min.js'></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <%- include ('global/navbar.ejs'); %>
  <%- include ('global/header');  %>
  <h1><%= data2.entity %></h1>
    <table>
      <tr>
        <th>Country</th>
        <th>Year</th>
        <th>Plastic waste generation (tons, total)</th>
        <th>Mismanaged waste (% global total)</th>
        <th>Share of plastic inadequately managed nationally (% of national total)</th>
        <th>Per capita plastic waste (kg/person/day)</th>
      </tr>
      <tr>
        <td><%= data2.entity %></td>
        <td><%= data2.year %></td>
        <td><%= data2.pwg %></td>
        <td><%= data2.mismanaged %></td>
        <td><%= data2.inadequate %></td>
        <td><%= data2.perCapita %></td>
      </tr>
    </table>
    <div id = "pieChart"></div>
    <div id = "mismanagedChart"></div>
    <div id = "perCapitaChart"></div>
  <script>
    //inadequateChart
    let totalWaste = <%= data2.pwg %>;
    let inadequate = <%= data2.inadequate %>/100;//bc this is a percentage
    let inadequateWaste = totalWaste * inadequate;
    let adequateWaste = totalWaste - inadequateWaste;
    let data = [{values: [inadequateWaste, adequateWaste],
                labels: ["Inadequately<br>managed waste","Adequately<br>managed waste"],
                type: "pie"
    }];
    let layout = {
      title: 'Share of plastic inadequately<br> managed nationally (% of national total)',
      height: 400,
      width: 500
    };
    Plotly.newPlot('pieChart', data, layout);

    //mismanagedChart
    let globalWaste = totalWaste/(<%= data2.mismanaged %>/100);
    data = [{values: [globalWaste - totalWaste, totalWaste],
                labels: ["Global mis-<br>managed waste", "<%= data2.entity %>'s<br>share of global mis-<br>managed waste"],
                type: "pie"
    }];
    layout = {
      title: 'Mismanaged waste (% global total)',
      height: 400,
      width: 500
    };
    Plotly.newPlot('mismanagedChart', data, layout);
    //barChart
    let labels = [<% for(let i=0; i<all_data.length; i++){ %>
                "<%= all_data[i].entity %>", <%}%>];
    let values = [<% for(let i=0; i<all_data.length; i++){ %>
                <%= all_data[i].perCapita %>, <%}%>];
    let colors = [<% for(let i=0; i<all_data.length; i++){ %>
                  '<%=
                  all_data[i].entity == data2.entity ? "rgba(222,45,38,0.8)": "rgba(204,204,204,1)";
                  %>', <%}%>
    ];
    //go through all data and put into lists
      let data1 = [{
      x: labels,
      y: values,
      marker:{
        color: colors
      },
      type: 'bar'
    }];
    layout = {
      xaxis: {title: 'Country'},
      yaxis: {title: 'Amount of Waste per Day in kilograms'},
      title: 'Per capita plastic waste (kg/person/day)'
    };
    Plotly.newPlot('perCapitaChart', data1, layout);
  </script>
  <section id="summ ary">
    <h2>Summary:</h2>
    <ul>
        <p>These infographics display <%= data2.entity %>'s plastic waste production and methods of disposing plastic waste.</p>
        <li id = "averagePWG"> <%= data2.entity %> produces <%= data2.pwg %> tons of plastic waste annually. The average annual plastic waste generation of the countries we researched is </li>
        <li> <%= data2.inadequate %>% of <%= data2.entity %>'s  waste is inadequately managed. </li>
        <li><%= data2.entity %> accounts for <%= data2.mismanaged %>% of global mismanaged waste.</li>
        <li id = "comparison"> The average amount of plastic waste generated by each person per day in <%= data2.entity %> is <%= data2.perCapita %> kg. When compared with the average per capita plastic waste generation of the countries we researched, <%= data2.entity %>'s daily per capita waste generation is </li>
    </ul>
  </section>
  <%- include ('global/footer');  %>
</body>

<script>
  let total = 0;
  let count = 0;
  let totalPWG = 0;

  <% for(var i=0; i<data.length; i++) {%>
      total = total + <%= data[i].perCapita %>
      count++;
      totalPWG = totalPWG + <%= data[i].pwg %>
    <% } %>
  let averagePC = total/count;
  let comparison = '';
  let comparisonArray = ['below average', 'average', 'above average'];
  if(<%= data2.perCapita %> < (averagePC - averagePC/5)){
    comparison = comparisonArray[0];
  }else if (<%= data2.perCapita %> > (averagePC + averagePC/5)){
    comparison = comparisonArray[2];
  }else if(<%= data2.perCapita %> >= (averagePC - averagePC/5) && <%= data2.perCapita %> <= (averagePC + averagePC/5)){
    comparison = comparisonArray[1];
  }
  document.getElementById("comparison").innerHTML = document.getElementById("comparison").innerHTML + comparison + ".";

  let comparePWG = '';
  let averagePWG = totalPWG/count;
  if(<%= data2.pwg %> < (averagePWG - averagePWG/5)){
    comparePWG = comparisonArray[0];
  }else if (<%= data2.pwg %> > (averagePWG + averagePWG/5)){
    comparePWG = comparisonArray[2];
  }else if(<%= data2.pwg %> >= (averagePWG - averagePWG/5) && <%= data2.perCapita %> <= (averagePWG + averagePWG/5)){
    comparePWG = comparisonArray[1];
  }
  document.getElementById("averagePWG").innerHTML = document.getElementById("averagePWG").innerHTML + averagePWG + " tons. Thus, <%= data2.entity %>'s yearly plastic waste generation is " + comparePWG + ".";

</script>
</html>
